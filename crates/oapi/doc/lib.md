Want to have your API documented with OpenAPI? But you don't want to see the
trouble with manual yaml or json tweaking? Would like it to be so easy that it would almost
be like salvo_oapi? Don't worry salvo_oapi is just there to fill this gap. It aims to do if not all then
the most of heavy lifting for you enabling you to focus writing the actual API logic instead of
documentation. It aims to be *minimal*, *simple* and *fast*. It uses simple proc macros which
you can use to annotate your code to have items documented.

Sapid crate provides autogenerated OpenAPI documentation for Rust REST APIs. It treats
code first approach as a first class citizen and simplifies API documentation by providing
simple macros for generating the documentation from your code.

It also contains Rust types of OpenAPI spec allowing you to write the OpenAPI spec only using
Rust if auto-generation is not your flavor or does not fit your purpose.

Long term goal of the library is to be the place to go when OpenAPI documentation is needed in Rust
codebase.

Sapid is framework agnostic and could be used together with any web framework or even without one. While
being portable and standalone one of it's key aspects is simple integration with web frameworks.

# Choose your flavor and document your API with ice cold IPA

[examples](https://github.com/salvo-rs/salvo_oapi/tree/master/examples)

# What's up with the word play?

The name comes from words `salvo_oapi` and `api` where `uto` is the first three letters of _salvo_oapi_
and the `ipa` is _api_ reversed. Aaand... `ipa` is also awesome type of beer.

# Crate Features

* **yaml** Enables **serde_yaml** serialization of OpenAPI objects.
* **debug** Add extra traits such as debug traits to openapi definitions and elsewhere.
* **chrono** Add support for [chrono](https://crates.io/crates/chrono) `DateTime`, `Date`, `NaiveDate` and `Duration`
  types. By default these types are parsed to `string` types with additional `format` information.
  `format: date-time` for `DateTime` and `format: date` for `Date` and `NaiveDate` according
  [RFC3339](https://xml2rfc.ietf.org/public/rfc/html/rfc3339.html#anchor14) as `ISO-8601`. To
  override default `string` representation users have to use `value_type` attribute to override the type.
  See [docs](https://docs.rs/salvo_oapi/latest/salvo_oapi/derive.AsSchema.html) for more details.
* **time** Add support for [time](https://crates.io/crates/time) `OffsetDateTime`, `PrimitiveDateTime`, `Date`, and `Duration` types.
  By default these types are parsed as `string`. `OffsetDateTime` and `PrimitiveDateTime` will use `date-time` format. `Date` will use
  `date` format and `Duration` will not have any format. To override default `string` representation users have to use `value_type` attribute
  to override the type. See [docs](https://docs.rs/salvo_oapi/latest/salvo_oapi/derive.AsSchema.html) for more details.
* **decimal** Add support for [rust_decimal](https://crates.io/crates/rust_decimal) `Decimal` type. **By default**
  it is interpreted as `String`. If you wish to change the format you need to override the type.
  See the `value_type` in [`AsSchema` derive docs][as_schema_derive].
* **uuid** Add support for [uuid](https://github.com/uuid-rs/uuid). `Uuid` type will be presented as `String` with
  format `uuid` in OpenAPI spec.
* **smallvec** Add support for [smallvec](https://crates.io/crates/smallvec). `SmallVec` will be treated as `Vec`.
* **indexmap** Add support for [indexmap](https://crates.io/crates/indexmap). When enabled `IndexMap` will be rendered as a map similar to
  `BTreeMap` and `HashMap`.

Sapid implicitly has partial support for `serde` attributes. See [`AsSchema` derive][serde] for more details.

# Install

Add minimal dependency declaration to Cargo.toml.
```toml
[dependencies]
salvo_oapi = "3"
```

To enable more features such as use salvo_oapi framework extras you could define the
dependency as follows.
```toml
[dependencies]
salvo_oapi = { version = "0.3"] }
```

**Note!** To use `salvo_oapi` together with Swagger UI you can use the [`salvo-oapi-swagger-ui`][salvo_oapi_swagger] crate.

[salvo_oapi_swagger]: <https://docs.rs/salvo-oapi-swagger-ui/>

# Examples

Create a struct or it could be an enum also. Add `AsSchema` derive macro to it so it can be registered
as a component in openapi schema.
```rust
use salvo_oapi::AsSchema;
#[derive(AsSchema)]
struct Pet {
   id: u64,
   name: String,
   age: Option<i32>,
}
```

Create an handler that would handle your business logic and add `endpoint` proc attribute macro over it.
```rust
mod pet_api {
#     use salvo_core::prelude::*;
#     use salvo_oapi::OpenApi;
#     use salvo_oapi::AsSchema;
#
#     #[derive(AsSchema)]
#     struct Pet {
#       id: u64,
#       name: String,
#       age: Option<i32>,
#     }
    /// Get pet by id
    ///
    /// Get pet from database by pet id
    #[salvo_oapi::endpoint(
        responses(
            (status = 200, description = "Pet found successfully", body = Pet),
            (status = NOT_FOUND, description = "Pet was not found")
        ),
        params(
            ("id", Path, description = "Pet database id to get Pet for"),
        )
    )]
    async fn get_pet_by_id(id: Path<u64>) -> Pet {
        Pet {
            id: pet_id,
            age: None,
            name: "lightning".to_string(),
        }
    }
}
```
Sapid has support for [http](https://crates.io/crates/http) `StatusCode` in responses.

Tie the component and the above api to the openapi schema with following `OpenApi` derive proc macro.
```rust
# mod pet_api {
#     use salvo_core::prelude::*;
#     use salvo_oapi::AsSchema;
#     use salvo_oapi::extract::Path;
#
#     #[derive(AsSchema)]
#     struct Pet {
#       id: u64,
#       name: String,
#       age: Option<i32>,
#     }
#
#     /// Get pet by id
#     ///
#     /// Get pet from database by pet id
#     #[salvo_oapi::endpoint(
#         responses(
#             (status = 200, description = "Pet found successfully", body = Pet),
#             (status = 404, description = "Pet was not found")
#         ),
#         params(
#             ("id" = u64, Path, description = "Pet database id to get Pet for"),
#         )
#     )]
#     async fn get_pet_by_id(id: Path<u64>) -> Pet {
#         Pet {
#             id: pet_id,
#             age: None,
#             name: "lightning".to_string(),
#         }
#     }
# }
# use salvo_oapi::AsSchema;
#
# #[derive(AsSchema)]
# struct Pet {
#   id: u64,
#   name: String,
#   age: Option<i32>,
# }

println!("{}", doc.to_pretty_json().unwrap());
```

# Go beyond the surface

* See how to serve OpenAPI doc via Swagger UI check [`salvo-oapi-swagger-ui`][salvo_oapi_swagger] crate for more details.
* Browse to [examples](https://github.com/juhaku/salvo_oapi/tree/master/examples) for more comprehensive examples.
* Check [`derive@AsResponses`] and [`derive@AsResponse`] for examples on deriving responses.
* More about OpenAPI security in [security documentation][security].

[path]: attr.path.html
[serde]: derive.AsSchema.html#partial-serde-attributes-support

[security]: openapi/security/index.html
[as_schema_derive]: derive.AsSchema.html